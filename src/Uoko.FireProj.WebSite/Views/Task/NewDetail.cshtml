
@{
    ViewBag.Title = "任务详细";
}
@section Css {
    <link href="~/Content/TaskDetail.css" rel="stylesheet" />
    <link href="~/Metronic/assets/admin/pages/css/timeline-old.css" rel="stylesheet" />
}
<input type="hidden" id="taskIdParam" value="@ViewBag.TaskId" />
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <i class="fa fa-home"></i>
            <a href="@Url.Action("Index","Home")">首页</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="@Url.Action("Index", "Task")">我的任务</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="#">任务详细</a>
        </li>
    </ul>
</div>
<div class="row" ng-controller="TaskController">
    <div class="col-md-12">
        <!-- 基本信息-->
        <div class="portlet box blue">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-clipboard"></i>基本信息
                </div>
            </div>
            <div class="portlet-body form">
                <div class="form-body">
                    <div class="row">
                        <div class="form-group form-md-line-input">
                            <label class="col-md-2 control-label">任务名</label>
                            <div class="col-md-10">
                                <input disabled type="text"  ng-model="model.TaskName" class="form-control" >
                              
                            </div>
                        </div>
                        <div class="form-group form-md-line-input">
                            <label class="col-md-2 control-label">项目</label>
                            <div class="col-md-10">
                                <input disabled type="text"  ng-model="model.ProjectName" class="form-control">
                            </div>
                        </div>
                        <div class="form-group form-md-line-input">
                            <label class="col-md-2 control-label">分支</label>
                            <div class="col-md-10">
                                <input disabled type="text"  ng-model="model.Branch" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- 基本信息-->
        <!-- 环境tab-->
        <div class="portlet box blue">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-phone"></i>环境信息
                </div>
            </div>
            <div class="portlet-body">
                <ul class="nav nav-tabs">
                    <li ng-class="{'active':currLogTab==0}"  ng-click="GetCurrLog(0)">
                        <a href="#tab_1_1" data-toggle="tab">
                            IOC
                        </a>
                    </li>
                    <li ng-class="{'active':currLogTab==1}"  ng-click="GetCurrLog(1)">
                        <a href="#tab_1_2" data-toggle="tab">
                            Pre
                        </a>
                    </li>
                    <li ng-class="{'active':currLogTab==2}"  ng-click="GetCurrLog(2)">
                        <a href="#tab_1_3" data-toggle="tab">
                            Online
                        </a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade " ng-class="{'active in':currLogTab==0}" id="tab_1_1">
                        <!-- BEGIN IOC CONTENT-->
                         <div>
                             <div class="form-group form-md-line-input">
                                 <label class="col-md-2 control-label">部署服务器IP</label>
                                 <div class="col-md-10">
                                     <input disabled type="text" ng-model="model.DeployInfoIocDto.DeployIP" class="form-control">
                                 </div>
                             </div>
                             <div class="form-group form-md-line-input">
                                 <label class="col-md-2 control-label">部署地址</label>
                                 <div class="col-md-10">
                                     <input disabled type="text" ng-model="model.DeployInfoIocDto.DeployAddress" class="form-control">
                                 </div>
                             </div>
                             <div class="form-group form-md-line-input">
                                 <label class="col-md-2 control-label">部署域名</label>
                                 <div class="col-md-10">
                                     <input disabled type="text" ng-model="model.DeployInfoIocDto.Domain" class="form-control">
                                 </div>
                             </div>
                             <div class="form-group form-md-line-input">
                                 <label class="col-md-2 control-label">IIS站点名称</label>
                                 <div class="col-md-10">
                                     <input disabled type="text" ng-model="model.DeployInfoIocDto.SiteName" class="form-control">
                                 </div>
                             </div>
                             
                             <div class="form-group form-md-line-input">
                                 <label class="col-md-2 control-label">验收人员</label>
                                 <div class="col-md-10">
                                     <div class="form-control-wrap">
                                         <tags-input ng-model="taskInfo.CheckUsers" placeholder="添加验收人员" display-property="name" add-from-autocomplete-only="true" minLength="1">
                                             <auto-complete source="loadTags($query)" load-on-focus="true" load-on-empty="true" minLength="0" max-results-to-show="32" template="my-custom-template"></auto-complete>
                                         </tags-input>
                                     </div>
                                 </div>
                             </div>
                             <div class="form-group form-md-line-input">
                                 <label class="col-md-2 control-label">相关人员</label>
                                 <div class="col-md-10">
                                     <div class="form-control-wrap">
                                         <tags-input ng-model="taskInfo.NoticeUses" placeholder="添加相关人员" display-property="name" add-from-autocomplete-only="true" minLength="1">
                                             <auto-complete source="loadTags($query)" load-on-focus="true" load-on-empty="true" minLength="0" max-results-to-show="32" template="my-custom-template"></auto-complete>
                                         </tags-input>
                                     </div>
                                 </div>
                             </div>
                             <div class="form-group form-md-line-input">
                                 <label class="col-md-2 control-label">备注</label>
                                 <div class="col-md-10">
                                     <div class="form-control-wrap">
                                         <textarea rows="4" ng-model="taskInfo.TaskDesc"></textarea>
                                     </div>
                                 </div>
                             </div>
                         </div>
                        <!-- END IOC CONTENT-->
                    </div>
                    <div class="tab-pane fade" ng-class="{'active in':currLogTab==1}" id="tab_1_2">
                        <!-- BEGIN Pre CONTENT-->
                        <div>
                            <div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">发布环境</label>
                                    <div class="col-md-10">
                                        <select name="deployenvironment" class="form-control" ng-model="taskInfo.DeployEnvironment" ng-change="GetServerData(taskInfo.DeployEnvironment)" required>
                                            <option ng-repeat="environment in environmentList" value="{{environment.Id}}" ng-selected="environment.Id==taskInfo.DeployEnvironment">{{environment.Name}}</option>
                                        </select>
                                        <div ng-show="form.$submitted || form.deployenvironment.$touched">
                                            <span class="error-msg" ng-show="form.deployenvironment.$error.required">项目必选.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">部署服务器</label>
                                    <div class="col-md-10">
                                        <select name="server" class="form-control" ng-model="taskInfo.Server" required>
                                            <option ng-repeat="server in ServerList" value="{{server}}" ng-selected="server.IP==taskInfo.DeployIP">{{server.Name}}</option>
                                        </select>
                                        <div ng-show="form.$submitted || form.server.$touched">
                                            <span class="error-msg" ng-show="form.server.$error.required">部署服务器必选</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">域名</label>
                                    <div class="col-md-10">
                                        <select name="domain" class="form-control" ng-model="taskInfo.Domain" required>
                                            <option ng-repeat="domain in DomainList" value="{{domain.Name}}" ng-selected="domain.Id==taskInfo.Domain">{{domain.Name}}</option>
                                        </select>
                                        <div ng-show="form.$submitted || form.domain.$touched">
                                            <span class="error-msg" ng-show="form.domain.$error.required">域名必选.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">IIS站点名称</label>
                                    <div class="col-md-10">
                                        <input disabled name="sitename" type="text" ng-model="taskInfo.SiteName" class="form-control" placeholder="自动生成" required>
                                        <div ng-show="form.$submitted || form.sitename.$touched">
                                            <span class="error-msg" ng-show="form.sitename.$error.required">自动生成.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">部署地址</label>
                                    <div class="col-md-10">
                                        <input disabled type="text" name="deployAddress" ng-model="taskInfo.DeployAddress" class="form-control" placeholder="自动生成" required>
                                        <div ng-show="form.$submitted || form.deployAddress.$touched">
                                            <span class="error-msg" ng-show="form.deployAddress.$error.required">自动生成.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">验收人员</label>
                                    <div class="col-md-10">
                                        <div class="form-control-wrap">
                                            <tags-input ng-model="taskInfo.CheckUsers" placeholder="添加验收人员" display-property="name" add-from-autocomplete-only="true" minLength="1">
                                                <auto-complete source="loadTags($query)" load-on-focus="true" load-on-empty="true" minLength="0" max-results-to-show="32" template="my-custom-template"></auto-complete>
                                            </tags-input>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">相关人员</label>
                                    <div class="col-md-10">
                                        <div class="form-control-wrap">
                                            <tags-input ng-model="taskInfo.NoticeUses" placeholder="添加相关人员" display-property="name" add-from-autocomplete-only="true" minLength="1">
                                                <auto-complete source="loadTags($query)" load-on-focus="true" load-on-empty="true" minLength="0" max-results-to-show="32" template="my-custom-template"></auto-complete>
                                            </tags-input>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">备注</label>
                                    <div class="col-md-10">
                                        <div class="form-control-wrap">
                                            <textarea rows="4" ng-model="taskInfo.TaskDesc"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- END Pre CONTENT-->
                    </div>
                    <div class="tab-pane fade" ng-class="{'active in':currLogTab==2}" id="tab_1_3">
                        <!-- BEGIN Online CONTENT-->
                        <div>
                            <div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">发布环境</label>
                                    <div class="col-md-10">
                                        <select name="deployenvironment" class="form-control" ng-model="taskInfo.DeployEnvironment" ng-change="GetServerData(taskInfo.DeployEnvironment)" required>
                                            <option ng-repeat="environment in environmentList" value="{{environment.Id}}" ng-selected="environment.Id==taskInfo.DeployEnvironment">{{environment.Name}}</option>
                                        </select>
                                        <div ng-show="form.$submitted || form.deployenvironment.$touched">
                                            <span class="error-msg" ng-show="form.deployenvironment.$error.required">项目必选.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">部署服务器</label>
                                    <div class="col-md-10">
                                        <select name="server" class="form-control" ng-model="taskInfo.Server" required>
                                            <option ng-repeat="server in ServerList" value="{{server}}" ng-selected="server.IP==taskInfo.DeployIP">{{server.Name}}</option>
                                        </select>
                                        <div ng-show="form.$submitted || form.server.$touched">
                                            <span class="error-msg" ng-show="form.server.$error.required">部署服务器必选</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">域名</label>
                                    <div class="col-md-10">
                                        <select name="domain" class="form-control" ng-model="taskInfo.Domain" required>
                                            <option ng-repeat="domain in DomainList" value="{{domain.Name}}" ng-selected="domain.Id==taskInfo.Domain">{{domain.Name}}</option>
                                        </select>
                                        <div ng-show="form.$submitted || form.domain.$touched">
                                            <span class="error-msg" ng-show="form.domain.$error.required">域名必选.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">IIS站点名称</label>
                                    <div class="col-md-10">
                                        <input disabled name="sitename" type="text" ng-model="taskInfo.SiteName" class="form-control" placeholder="自动生成" required>
                                        <div ng-show="form.$submitted || form.sitename.$touched">
                                            <span class="error-msg" ng-show="form.sitename.$error.required">自动生成.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">部署地址</label>
                                    <div class="col-md-10">
                                        <input disabled type="text" name="deployAddress" ng-model="taskInfo.DeployAddress" class="form-control" placeholder="自动生成" required>
                                        <div ng-show="form.$submitted || form.deployAddress.$touched">
                                            <span class="error-msg" ng-show="form.deployAddress.$error.required">自动生成.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">验收人员</label>
                                    <div class="col-md-10">
                                        <div class="form-control-wrap">
                                            <tags-input ng-model="taskInfo.CheckUsers" placeholder="添加验收人员" display-property="name" add-from-autocomplete-only="true" minLength="1">
                                                <auto-complete source="loadTags($query)" load-on-focus="true" load-on-empty="true" minLength="0" max-results-to-show="32" template="my-custom-template"></auto-complete>
                                            </tags-input>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">相关人员</label>
                                    <div class="col-md-10">
                                        <div class="form-control-wrap">
                                            <tags-input ng-model="taskInfo.NoticeUses" placeholder="添加相关人员" display-property="name" add-from-autocomplete-only="true" minLength="1">
                                                <auto-complete source="loadTags($query)" load-on-focus="true" load-on-empty="true" minLength="0" max-results-to-show="32" template="my-custom-template"></auto-complete>
                                            </tags-input>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group form-md-line-input">
                                    <label class="col-md-2 control-label">备注</label>
                                    <div class="col-md-10">
                                        <div class="form-control-wrap">
                                            <textarea rows="4" ng-model="taskInfo.TaskDesc"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- END Online CONTENT-->
                    </div>
                </div>
            </div>
        </div>
        <!-- 环境tab-->


        <!--操作按钮-->
        <div class="form-actions right">
            <button type="button" class="btn blue" ng-click="Edit()"><i class="fa fa-edit"></i> 编辑</button>
            <button type="button" class="btn blue" ng-show="taskInfo.Status==0||taskInfo.Status==4||taskInfo.Status==10" ng-click="Deploy()"><i class="fa fa-building-o"></i> 编译部署</button>
            <button type="button" class="btn blue" ng-show="taskInfo.Status==6" ng-click="CommitToTest()"><i class="fa fa-angle-up"></i> 提交测试</button>
            <button type="button" class="btn green" ng-show="taskInfo.Status==8" ng-click="Tested()"><i class="fa fa-check"></i> 测试通过</button>
            <button type="button" class="btn red" ng-show="taskInfo.Status==8" ng-click="TestFails()"><i class="fa fa-times"></i> 测试不通过</button>
            <button type="button" class="btn default" ng-click="Cancel()">返回列表</button>
        </div>
        <!--操作按钮-->


        <!-- 任务记录-->
        <div class="portlet box blue">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-phone"></i>任务记录
                </div>
            </div>
            <!-- BEGIN Logs CONTENT-->
            <div class="portlet light">
                <div class="portlet-body">
                    <div class="row">
                        <div class="col-md-12">
                            <ul class="timeline">
                                <li class="timeline-blue" ng-repeat="item in items">
                                    <div class="timeline-time">
                                        <span class="date">
                                            {{item.CreateDate| date : 'yyyy-MM-dd'}}
                                        </span>
                                        <span class="time">
                                            {{item.CreateDate| date : 'HH:MM:ss'}}
                                        </span>
                                    </div>
                                    <div class="timeline-icon">
                                        <i >{{item.Stage|environmentFilter}}</i>
                                    </div>
                                    <div class="timeline-body">
                                        <h2>{{item.Comments}}</h2>
                                        <div class="timeline-content">
                                            <h4>{{item.Comments}}</h4>
                                        </div>
                                        @*<div class="timeline-footer">
                                            <a class="text-danger" href="javascript:;" ng-show="item.BuildId!=0" ng-click="GotoGitLabBuildPage(item.BuildId)">错误详细<i class="m-icon-swapright m-icon-white"></i></a>
                                        </div>*@
                                        <div class="timeline-footer">
                                            <span class="nav-link pull-right">
                                                {{item.CreateBy}}
                                            </span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END Logs CONTENT-->
        </div>
        <!-- 任务记录-->
    </div>
</div>
@section Scripts {
    <script src="~/app/services/CommonService.js"></script>
    <script src="~/app/services/ProjectService.js"></script>
    <script src="~/app/services/TaskService.js"></script>
    <script src="~/app/filters/CommonFilter.js"></script>
    <script src="~/app/controllers/TaskDetail.js"></script>
}

